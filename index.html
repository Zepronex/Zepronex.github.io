<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPI Trend Sweden and Stockholm</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Papa Parse -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
      /* Layout */
      body {
        font-family: Georgia, "Times New Roman", serif;
        background: #f5f6fa;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1.5rem;
      }
      #card {
        width: 100%;
        max-width: 720px;
        background: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        padding: 2.25rem 1.75rem;
      }
      /* Button */
      #toggleBtn {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      #toggleBtn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(79, 70, 229, 0.3);
      }
      /* Chart grid line colour override */
      .chart-grid line {
        stroke: rgba(0, 0, 0, 0.04);
      }
    </style>
  </head>
  <body>
    <div id="card" class="flex flex-col gap-6">
      <h1 class="text-center text-indigo-700 text-3xl md:text-4xl font-bold">
        KPI Trend 1980 to 2024
      </h1>

      <div class="relative w-full" style="height:360px;">
        <canvas id="myChart" class="absolute inset-0 w-full"></canvas>
      </div>

      <button
        id="toggleBtn"
        class="self-center px-7 py-3 rounded-full bg-indigo-600 hover:bg-indigo-700 text-white text-lg font-semibold focus:outline-none"
      >
        Show Stockholm KPI
      </button>

      <p id="info" class="text-gray-700 text-center text-base">
        The chart shows how the consumer price index has developed in Sweden and in the Stockholm region from 1980 to 2024. Click the button to switch between the two series.
      </p>
    </div>

    <script>
      const ctx = document.getElementById("myChart").getContext("2d");
      let chart;
      let showingSweden = true;
      let dataSweden;
      let dataStockholm;

      Promise.all([
        fetch("sweden_kpi.csv").then(r => r.text()),
        fetch("stockholm_kpi.csv").then(r => r.text())
      ])
        .then(([swedenCSV, stockholmCSV]) => {
          const swedenRows = Papa.parse(swedenCSV, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true
          }).data;

          const stockholmRows = Papa.parse(stockholmCSV, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true
          }).data;

          const labels = swedenRows.map(r => r.Year);
          const swedenValues = swedenRows.map(r => Object.values(r)[1]);
          const stockholmValues = stockholmRows.map(r => Object.values(r)[1]);

          const allValues = swedenValues.concat(stockholmValues);
          const globalMin = Math.floor(Math.min(...allValues) / 10) * 10;
          const globalMax = Math.ceil(Math.max(...allValues) / 10) * 10;

          dataSweden = {
            labels,
            datasets: [
              {
                label: "KPI Sweden",
                data: swedenValues,
                fill: true,
                tension: 0.35,
                borderColor: "#4f46e5",
                backgroundColor: "rgba(79,70,229,0.12)",
                pointRadius: 3
              }
            ]
          };

          dataStockholm = {
            labels,
            datasets: [
              {
                label: "KPI Stockholm",
                data: stockholmValues,
                fill: true,
                tension: 0.35,
                borderColor: "#7c3aed",
                backgroundColor: "rgba(124,58,237,0.12)",
                pointRadius: 3
              }
            ]
          };

          chart = new Chart(ctx, {
            type: "line",
            data: dataSweden,
            options: {
              responsive: true,
              animation: {
                duration: 800,
                easing: "easeInOutQuad"
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: c => c.parsed.y.toFixed(1)
                  }
                }
              },
              scales: {
                x: {
                  grid: { display: false },
                  ticks: { maxRotation: 45, minRotation: 45 }
                },
                y: {
                  min: globalMin,
                  max: globalMax,
                  ticks: {
                    stepSize: 50
                  },
                  grid: { color: "rgba(0,0,0,0.04)" }
                }
              }
            }
          });
        })
        .catch(err => console.error("CSV load error", err));

      document.getElementById("toggleBtn").addEventListener("click", () => {
        if (!dataSweden || !dataStockholm) return;

        showingSweden = !showingSweden;
        chart.data = showingSweden ? dataSweden : dataStockholm;
        chart.update();

        document.getElementById("toggleBtn").textContent =
          showingSweden ? "Show Stockholm KPI" : "Show Sweden KPI";
      });
    </script>
  </body>
</html>
