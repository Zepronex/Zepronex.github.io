<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPI Toggle ‚Äì Sweden vs Stockholm</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

    <!-- Tailwind CSS (utility-first styling) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Papa Parse (CSV ‚Üí JS) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
      }
      #card {
        width: 100%;
        max-width: 640px;
        background: white;
        border-radius: 1.5rem; /* 24px */
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
        padding: 2rem;
      }
      #toggleBtn {
        transition: transform 0.2s ease;
      }
      #toggleBtn:hover {
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <div id="card" class="flex flex-col gap-6">
      <div class="relative w-full" style="height:350px;">
        <canvas id="myChart" class="absolute inset-0 w-full"></canvas>
      </div>

      <button
        id="toggleBtn"
        class="self-center px-6 py-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold shadow-lg focus:outline-none"
      >
        Show Stockholm KPI
      </button>

      <p id="info" class="text-gray-600 leading-relaxed text-center">
        Hej och v√§lkommen till Elliots extremt coola hemsida som illustrerar Sveriges KPI-historia ‚Äì tryck p√• knappen f√∂r att v√§xla mellan hela landet och Stor-Stockholm.
      </p>
    </div>

    <script>
      /* -------------------------------------------------------
       * Fetch CSVs ‚Üí build two datasets with a SHARED Y-axis range
       * -----------------------------------------------------*/
      const ctx = document.getElementById("myChart").getContext("2d");
      let chart, showingSweden = true;
      let dataSweden, dataStockholm;

      Promise.all([
        fetch("sweden_kpi.csv").then(r => r.text()),
        fetch("stockholm_kpi.csv").then(r => r.text())
      ])
        .then(([swedenCSV, stockholmCSV]) => {
          const swedenRows = Papa.parse(swedenCSV, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
          }).data;

          const stockholmRows = Papa.parse(stockholmCSV, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
          }).data;

          // Extract labels & values
          const labels = swedenRows.map(r => r.Year);
          const swedenValues    = swedenRows.map(r => Object.values(r)[1]);
          const stockholmValues = stockholmRows.map(r => Object.values(r)[1]);

          // üîë  Global min/max for a static Y-axis
          const allValues = swedenValues.concat(stockholmValues);
          const globalMin = Math.floor(Math.min(...allValues) / 10) * 10; // round to nearest 10
          const globalMax = Math.ceil (Math.max(...allValues) / 10) * 10;

          dataSweden = {
            labels,
            datasets: [
              {
                label: "KPI ‚Äì Hela Sverige (1980‚Äì2024)",
                data: swedenValues,
                fill: true,
                tension: 0.35,
                borderColor: "rgba(99,102,241,1)",
                backgroundColor: "rgba(99,102,241,.15)",
                pointRadius: 3,
              },
            ],
          };

          dataStockholm = {
            labels,
            datasets: [
              {
                label: "KPI ‚Äì Stor-Stockholm (1980‚Äì2024)",
                data: stockholmValues,
                fill: true,
                tension: 0.35,
                borderColor: "rgba(139,92,246,1)",
                backgroundColor: "rgba(139,92,246,.15)",
                pointRadius: 3,
              },
            ],
          };

          // Initial render (Sweden) with fixed Y-axis
          chart = new Chart(ctx, {
            type: "line",
            data: dataSweden,
            options: {
              responsive: true,
              animation: {
                duration: 800,
                easing: "easeInOutQuart",
              },
              plugins: {
                legend: { display: false },
              },
              scales: {
                y: {
                  min: globalMin,
                  max: globalMax,
                  ticks: {
                    stepSize: 50,
                  },
                },
              },
            },
          });
        })
        .catch(err => console.error("CSV load error:", err));

      /* -------------------------------------------------------
       * Toggle logic ‚Äì swap datasets & button label
       * -----------------------------------------------------*/
      document.getElementById("toggleBtn").addEventListener("click", () => {
        if (!dataSweden || !dataStockholm) return; // still loading

        showingSweden = !showingSweden;
        chart.data = showingSweden ? dataSweden : dataStockholm;
        chart.update();

        document.getElementById("toggleBtn").textContent =
          showingSweden ? "Show Stockholm KPI" : "Show Sweden KPI";
      });
    </script>
  </body>
</html>